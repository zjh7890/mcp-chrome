# æ¨¡å‹ç¼“å­˜ç®¡ç†ç³»ç»Ÿ - å®Œæ•´å®ç°æ€»ç»“

## ğŸ¯ æ ¸å¿ƒé—®é¢˜è§£å†³

### åŸå§‹é—®é¢˜

- HuggingFaceæ¨¡å‹URLä½¿ç”¨åŠ¨æ€ç­¾åï¼Œæ¯æ¬¡è¯·æ±‚ç”Ÿæˆä¸åŒçš„é‡å®šå‘URL
- æµè§ˆå™¨æ— æ³•ç¼“å­˜è¿™äº›åŠ¨æ€URLï¼Œå¯¼è‡´æ¯æ¬¡åˆå§‹åŒ–éƒ½é‡æ–°ä¸‹è½½116MBæ¨¡å‹
- ç”¨æˆ·ä½“éªŒå·®ï¼Œç­‰å¾…æ—¶é—´é•¿

### è§£å†³æ–¹æ¡ˆ

- ä½¿ç”¨ç¨³å®šçš„HuggingFace URLä½œä¸ºç¼“å­˜key
- åˆ©ç”¨æµè§ˆå™¨Cache APIå­˜å‚¨æ¨¡å‹ArrayBuffer
- å®ç°æ™ºèƒ½ç¼“å­˜ç®¡ç†ï¼Œé˜²æ­¢ç¼“å­˜æ— é™å¢é•¿

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ ¸å¿ƒç¼“å­˜æœºåˆ¶

```javascript
// æ™ºèƒ½ç¼“å­˜å‡½æ•°
async function getCachedModelData(modelUrl) {
  const cache = await caches.open(CACHE_NAME);

  // æ£€æŸ¥ç¼“å­˜å¹¶éªŒè¯è¿‡æœŸçŠ¶æ€
  const cachedResponse = await cache.match(modelUrl);
  if (cachedResponse && !isExpired(metadata)) {
    return cachedResponse.arrayBuffer();
  }

  // ç½‘ç»œè·å–å¹¶ç¼“å­˜
  const response = await fetch(modelUrl);
  await cache.put(modelUrl, response.clone());
  await storeCacheMetadata(modelUrl, response.size);

  return response.arrayBuffer();
}
```

### 2. Workeré€šä¿¡ä¼˜åŒ–

```javascript
// æ”¯æŒArrayBufferä¼ é€’ï¼ˆé›¶æ‹·è´ï¼‰
await this._sendMessageToWorker(
  'init',
  {
    modelData: arrayBuffer,
    numThreads: 4,
    executionProviders: ['wasm'],
  },
  [arrayBuffer],
); // Transferable Objects

// Workerç«¯å¤„ç†
if (modelPathOrData instanceof ArrayBuffer) {
  session = await ort.InferenceSession.create(modelPathOrData, options);
}
```

### 3. ç¼“å­˜ç®¡ç†ç­–ç•¥

#### è‡ªåŠ¨æ¸…ç†æœºåˆ¶

- **æ—¶é—´è¿‡æœŸ**ï¼š7å¤©è‡ªåŠ¨è¿‡æœŸ
- **å¤§å°é™åˆ¶**ï¼šæœ€å¤§500MBï¼Œè¶…å‡ºæ—¶åˆ é™¤æœ€æ—§æ¡ç›®
- **å®šæœŸæ¸…ç†**ï¼šåå°æ¯24å°æ—¶è‡ªåŠ¨æ¸…ç†
- **å…ƒæ•°æ®ç®¡ç†**ï¼šè®°å½•æ—¶é—´æˆ³ã€å¤§å°ã€ç‰ˆæœ¬ä¿¡æ¯

#### æ‰‹åŠ¨ç®¡ç†åŠŸèƒ½

- **Popupç•Œé¢**ï¼šç¼“å­˜ç»Ÿè®¡ã€æ‰‹åŠ¨æ¸…ç†ã€æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
- **APIæ¥å£**ï¼š`getCacheStats()`, `cleanupModelCache()`, `clearModelCache()`

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶

1. **`utils/semantic-similarity-engine.ts`**

   - æ·»åŠ å®Œæ•´çš„ç¼“å­˜ç®¡ç†ç³»ç»Ÿ
   - å®ç°è¿‡æœŸæ£€æŸ¥ã€å¤§å°é™åˆ¶ã€å…ƒæ•°æ®ç®¡ç†
   - å¯¼å‡ºç¼“å­˜ç®¡ç†APIå‡½æ•°

2. **`workers/similarity.worker.js`**

   - æ”¯æŒArrayBufferå’ŒURLä¸¤ç§è¾“å…¥æ–¹å¼
   - å‘åå…¼å®¹æœ¬åœ°æ–‡ä»¶æ¨¡å¼

3. **`entrypoints/background/index.ts`**

   - æ·»åŠ å®šæœŸç¼“å­˜æ¸…ç†ä»»åŠ¡ï¼ˆæ¯24å°æ—¶ï¼‰
   - å¯åŠ¨æ—¶æ‰§è¡Œåˆå§‹æ¸…ç†

4. **`entrypoints/popup/App.vue`**
   - æ·»åŠ ç¼“å­˜ç®¡ç†UIç•Œé¢
   - å®ç°ç¼“å­˜ç»Ÿè®¡æ˜¾ç¤ºå’Œæ‰‹åŠ¨ç®¡ç†åŠŸèƒ½

### æµ‹è¯•å’Œæ–‡æ¡£

5. **`test-cache.html`** - ç¼“å­˜åŠŸèƒ½æµ‹è¯•é¡µé¢
6. **`CACHE_IMPROVEMENT.md`** - è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
7. **`CACHE_MANAGEMENT_SUMMARY.md`** - æœ¬æ€»ç»“æ–‡æ¡£

## ğŸš€ æ€§èƒ½æå‡

### ç”¨æˆ·ä½“éªŒæ”¹è¿›

- **é¦–æ¬¡åŠ è½½**ï¼šæ­£å¸¸ä¸‹è½½æ—¶é—´ï¼ˆ~30-60ç§’ï¼‰
- **åç»­åŠ è½½**ï¼šå‡ ä¹ç¬æ—¶å®Œæˆï¼ˆ<1ç§’ï¼‰
- **é‡æ–°åˆå§‹åŒ–**ï¼šä½¿ç”¨ç¼“å­˜ï¼Œæ— éœ€é‡æ–°ä¸‹è½½
- **æµè§ˆå™¨é‡å¯**ï¼šç¼“å­˜æŒä¹…åŒ–ï¼Œé‡å¯åä»ç„¶æœ‰æ•ˆ

### èµ„æºèŠ‚çœ

- **ç½‘ç»œå¸¦å®½**ï¼šé¿å…é‡å¤ä¸‹è½½å¤§æ–‡ä»¶
- **å­˜å‚¨ç©ºé—´**ï¼šæ™ºèƒ½æ¸…ç†ï¼Œé˜²æ­¢æ— é™å¢é•¿
- **å†…å­˜ä½¿ç”¨**ï¼šé›¶æ‹·è´ä¼ è¾“ï¼Œä¼˜åŒ–å†…å­˜æ•ˆç‡

## ğŸ›¡ï¸ å®‰å…¨å’Œç¨³å®šæ€§

### é”™è¯¯å¤„ç†

- ç½‘ç»œå¤±è´¥æ—¶è‡ªåŠ¨æ¸…ç†ä¸å®Œæ•´ç¼“å­˜
- å…ƒæ•°æ®æŸåæ—¶è‡ªåŠ¨é‡å»º
- ç¼“å­˜ç‰ˆæœ¬æ§åˆ¶ï¼Œæ”¯æŒå¼ºåˆ¶æ›´æ–°

### é…ç½®å‚æ•°

```javascript
const CACHE_NAME = 'onnx-model-cache-v1';
const CACHE_EXPIRY_DAYS = 7;
const MAX_CACHE_SIZE_MB = 500;
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯

1. **åŸºæœ¬ç¼“å­˜**ï¼šé¦–æ¬¡ä¸‹è½½å’Œåç»­åŠ è½½
2. **è¿‡æœŸå¤„ç†**ï¼šæ—¶é—´è¿‡æœŸè‡ªåŠ¨æ¸…ç†
3. **å¤§å°é™åˆ¶**ï¼šè¶…å‡ºé™åˆ¶æ—¶LRUæ¸…ç†
4. **æ‰‹åŠ¨ç®¡ç†**ï¼šUIç•Œé¢æ“ä½œ
5. **é”™è¯¯æ¢å¤**ï¼šç½‘ç»œå¤±è´¥å’Œæ•°æ®æŸå

### æµ‹è¯•å·¥å…·

- `test-cache.html`ï¼šå®Œæ•´çš„ç¼“å­˜åŠŸèƒ½æµ‹è¯•é¡µé¢
- Popupç•Œé¢ï¼šå®æ—¶ç¼“å­˜ç»Ÿè®¡å’Œç®¡ç†
- æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼šCache Storageæ£€æŸ¥

## ğŸ“ˆ æœªæ¥æ‰©å±•

### å¯èƒ½çš„æ”¹è¿›

1. **å‹ç¼©å­˜å‚¨**ï¼šä½¿ç”¨gzipå‹ç¼©å‡å°‘å­˜å‚¨ç©ºé—´
2. **å¢é‡æ›´æ–°**ï¼šæ”¯æŒæ¨¡å‹ç‰ˆæœ¬å¢é‡æ›´æ–°
3. **å¤šæ¨¡å‹ç®¡ç†**ï¼šæ›´æ™ºèƒ½çš„å¤šæ¨¡å‹ç¼“å­˜ç­–ç•¥
4. **ç”¨æˆ·é…ç½®**ï¼šå…è®¸ç”¨æˆ·è‡ªå®šä¹‰ç¼“å­˜å‚æ•°

### ç›‘æ§æŒ‡æ ‡

- ç¼“å­˜å‘½ä¸­ç‡
- å¹³å‡åŠ è½½æ—¶é—´
- å­˜å‚¨ç©ºé—´ä½¿ç”¨
- æ¸…ç†é¢‘ç‡ç»Ÿè®¡

## âœ… æ€»ç»“

è¿™ä¸ªç¼“å­˜ç®¡ç†ç³»ç»Ÿå®Œç¾è§£å†³äº†HuggingFaceåŠ¨æ€URLçš„ç¼“å­˜é—®é¢˜ï¼Œå®ç°äº†ï¼š

1. **æ™ºèƒ½ç¼“å­˜**ï¼šè‡ªåŠ¨å¤„ç†é‡å®šå‘ï¼Œä½¿ç”¨ç¨³å®šURLä½œä¸ºkey
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šé›¶æ‹·è´ä¼ è¾“ï¼Œå¤§å¹…æå‡åŠ è½½é€Ÿåº¦
3. **èµ„æºç®¡ç†**ï¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸå’Œè¶…å¤§ç¼“å­˜ï¼Œé˜²æ­¢å­˜å‚¨ç©ºé—´æ— é™å¢é•¿
4. **ç”¨æˆ·å‹å¥½**ï¼šæä¾›ç›´è§‚çš„ç®¡ç†ç•Œé¢å’Œè¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯
5. **å‘åå…¼å®¹**ï¼šä¿æŒå¯¹æœ¬åœ°æ–‡ä»¶æ¨¡å¼çš„å®Œå…¨æ”¯æŒ

ç”¨æˆ·ç°åœ¨å¯ä»¥äº«å—åˆ°é¦–æ¬¡ä¸‹è½½åå‡ ä¹ç¬æ—¶çš„æ¨¡å‹åŠ è½½ä½“éªŒï¼ŒåŒæ—¶ä¸ç”¨æ‹…å¿ƒç¼“å­˜ç®¡ç†é—®é¢˜ï¼
